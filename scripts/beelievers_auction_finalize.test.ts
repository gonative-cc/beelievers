import { expect, test, describe } from "vitest";
import { batchAddresses, preprocessAddresses } from "./beelievers_auction_finalize.js";

describe("preprocess Address | sort and validate address", () => {
	test("preprocess happy case", () => {
		expect(preprocessAddresses([
			"0x1000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000001"
		])).toStrictEqual([
			"0x0000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000001",
			"0x1000000000000000000000000000000000000000000000000000000000000000"
		])
	});

	test("preprocess failed case", () => {
		expect(() => preprocessAddresses([
			"0x100000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000001"
		])).toThrow("invalid sui address in finalize list")
	});
});



describe("batchAddresses tests", () => {
	test("batchAddresses happy case", () => {
		expect(batchAddresses(preprocessAddresses([
			"0x1000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000001"
		]), 2)).toStrictEqual([
			["0x0000000000000000000000000000000000000000000000000000000000000000",
			"0x0000000000000000000000000000000000000000000000000000000000000001"],
			["0x1000000000000000000000000000000000000000000000000000000000000000"]
		])
	});

	test("preprocess failed case", () => {
		expect(() => batchAddresses([
		], 10)).toThrow("list address is empty")
	});
});
